@startuml Diagram_Klas
skinparam classAttributeIconSize 0
skinparam backgroundColor #1e1e2e
skinparam class {
    BackgroundColor #313244
    BorderColor #89b4fa
    FontColor #cdd6f4
    ArrowColor #89b4fa
}

title Diagram Klas - Sieciowa Tablica Ogłoszeń
footer Autorzy: Dawid Sułek, Dominik Rodziewicz

package "pl.tablicaogloszen.wspolne" #181825 {
    class OgloszenieDTO <<Serializable>> {
        - int id
        - String tytul
        - String tresc
        - String daneKontaktowe
        - String kategoria
        - int idAutora
        - String autor
        - LocalDateTime dataDodania
        - int wyswietlenia
        - int zgloszenia
        + gettery()
        + settery()
    }
    
    class UzytkownikDTO <<Serializable>> {
        - int id
        - String login
        - String rola
        + getId(): int
        + getLogin(): String
        + getRola(): String
    }
    
    class FiltrDTO <<Serializable>> {
        - String kategoria
        - String autor
        - String szukajTekst
        - String sortowanie
    }
    
    class Zadanie <<Serializable>> {
        - TypZadania typ
        - Object dane
        + getTyp(): TypZadania
        + getDane(): Object
    }
    
    class Odpowiedz <<Serializable>> {
        - StatusOdpowiedzi status
        - Object dane
        - String wiadomosc
    }
    
    enum TypZadania {
        LOGOWANIE
        REJESTRACJA
        POBIERZ_OGLOSZENIA
        POBIERZ_OGLOSZENIA_FILTR
        DODAJ_OGLOSZENIE
        EDYTUJ_OGLOSZENIE
        USUN_OGLOSZENIE
        POBIERZ_KATEGORIE
        ODSWIEZ
        ZGLOS_OGLOSZENIE
        POBIERZ_SZCZEGOLY
        POBIERZ_ZGLOSZONE
        GENERUJ_RAPORT
    }
    
    enum StatusOdpowiedzi {
        OK
        BLAD
        ODSWIEZ
    }
}

package "pl.tablicaogloszen.serwer" #181825 {
    class Serwer {
        - {static} int PORT
        - {static} Set<ObslugaKlienta> klienci
        - {static} ExecutorService pulaWatkow
        + {static} main(args)
        + {static} usunKlienta(klient)
        + {static} powiadomWszystkich()
    }
    
    class ObslugaKlienta <<Runnable>> {
        - Socket gniazdo
        - ObjectOutputStream wyjscie
        - ObjectInputStream wejscie
        - UzytkownikDTO zalogowanyUzytkownik
        + run()
        - obslozZadanie(zadanie)
        + wyslij(odpowiedz)
    }
    
    class PolaczenieBazy <<Singleton>> {
        - {static} String URL
        - {static} Connection polaczenie
        + {static} pobierzPolaczenie(): Connection
    }
    
    class Bezpieczenstwo {
        + {static} hashuj(haslo): String
    }
    
    class InicjalizatorBazy {
        + {static} inicjalizuj()
    }
    
    class OgloszenieDAO {
        + dodajOgloszenie(ogl, idAutora): boolean
        + edytujOgloszenie(ogl, idUzyt, czyAdmin): boolean
        + usunOgloszenie(idOgl, idUzyt, czyAdmin): boolean
        + pobierzZFiltrem(filtr): List<OgloszenieDTO>
        + pobierzWszystkie(): List<OgloszenieDTO>
        + pobierzKategorie(): List<String>
        + zwiekszWyswietlenia(idOgl): void
        + zglosOgloszenie(idOgl): void
        + pobierzZgloszone(): List<OgloszenieDTO>
        + generujRaport(): String
    }
    
    class UzytkownikDAO {
        + zarejestruj(login, haslo): boolean
        + zaloguj(login, haslo): UzytkownikDTO
    }
}

package "pl.tablicaogloszen.klient" #181825 {
    class AplikacjaKlienta <<JavaFX Application>> {
        - {static} Stage glownaScena
        + start(stage)
        + {static} zaladujWidok(fxml)
        + {static} main(args)
    }
    
    class KlientSieciowy <<Singleton>> {
        - {static} KlientSieciowy instancja
        - Socket gniazdo
        - ObjectOutputStream wyjscie
        - ObjectInputStream wejscie
        - KontrolerTablicy kontrolerTablicy
        + {static} pobierzInstancje(): KlientSieciowy
        + wyslijISprawdz(zadanie): Odpowiedz
        - nasluchuj()
    }
    
    class KontrolerLogowania <<FXML Controller>> {
        - TextField poleLogin
        - PasswordField poleHaslo
        - zaloguj()
        - idzDoRejestracji()
    }
    
    class KontrolerRejestracji <<FXML Controller>> {
        - TextField poleLogin
        - PasswordField poleHaslo
        - PasswordField polePowtorzHaslo
        - zarejestruj()
        - wrocDoLogowania()
    }
    
    class KontrolerTablicy <<FXML Controller>> {
        - FlowPane kontenerOgloszen
        - ComboBox filtrKategoria
        - ComboBox filtrSortowanie
        + initialize()
        + odswiezListe()
        - zastosujFiltr()
        - dodajOgloszenie()
        - edytujOgloszenie(ogl)
        - usunOgloszenie(ogl)
        - zglosOgloszenie(ogl)
        - pokazSzczegoly(ogl)
        - pobierzZgloszone()
        - generujRaport()
    }
    
    class Sesja {
        - {static} UzytkownikDTO zalogowanyUzytkownik
        + {static} getZalogowanyUzytkownik()
        + {static} setZalogowanyUzytkownik(u)
        + {static} czyAdmin(): boolean
    }
}

' Relacje
Serwer "1" *-- "*" ObslugaKlienta : zarządza
ObslugaKlienta ..> OgloszenieDAO : używa
ObslugaKlienta ..> UzytkownikDAO : używa
OgloszenieDAO ..> PolaczenieBazy : pobiera Connection
UzytkownikDAO ..> PolaczenieBazy : pobiera Connection
UzytkownikDAO ..> Bezpieczenstwo : hashuje hasła

AplikacjaKlienta ..> KontrolerLogowania : ładuje FXML
AplikacjaKlienta ..> KontrolerRejestracji : ładuje FXML
AplikacjaKlienta ..> KontrolerTablicy : ładuje FXML

KontrolerLogowania ..> KlientSieciowy : używa
KontrolerRejestracji ..> KlientSieciowy : używa
KontrolerTablicy ..> KlientSieciowy : używa
KontrolerTablicy ..> Sesja : sprawdza uprawnienia

KlientSieciowy ..> Zadanie : wysyła
KlientSieciowy ..> Odpowiedz : odbiera
ObslugaKlienta ..> Zadanie : odbiera
ObslugaKlienta ..> Odpowiedz : wysyła

@enduml

' ================================================

@startuml Diagram_Przypadkow_Uzycia
left to right direction
skinparam backgroundColor #1e1e2e
skinparam usecase {
    BackgroundColor #313244
    BorderColor #89b4fa
    FontColor #cdd6f4
}
skinparam actor {
    BackgroundColor #89b4fa
    BorderColor #89b4fa
}

title Diagram Przypadków Użycia - Sieciowa Tablica Ogłoszeń
footer Autorzy: Dawid Sułek, Dominik Rodziewicz

actor "Użytkownik\n(niezalogowany)" as Guest
actor "Użytkownik\n(zalogowany)" as User
actor "Administrator" as Admin

rectangle "System Tablicy Ogłoszeń" {
    ' Podstawowe
    usecase "Rejestracja" as UC_REG
    usecase "Logowanie" as UC_LOG
    usecase "Przeglądanie ogłoszeń" as UC_VIEW
    usecase "Filtrowanie ogłoszeń" as UC_FILTER
    usecase "Sortowanie ogłoszeń" as UC_SORT
    
    ' Zalogowany użytkownik
    usecase "Dodawanie ogłoszenia" as UC_ADD
    usecase "Edycja własnego ogłoszenia" as UC_EDIT
    usecase "Usuwanie własnego ogłoszenia" as UC_DEL
    usecase "Wyświetlanie szczegółów" as UC_DETAILS
    usecase "Zgłaszanie ogłoszenia" as UC_REPORT_AD
    
    ' Administrator
    usecase "Usuwanie dowolnego ogłoszenia" as UC_ADMIN_DEL
    usecase "Przeglądanie zgłoszonych" as UC_VIEW_REPORTED
    usecase "Generowanie raportu" as UC_REPORT
    
    ' System
    usecase "Odbieranie powiadomień real-time" as UC_PUSH
}

' Niezalogowany
Guest --> UC_REG
Guest --> UC_LOG
Guest --> UC_VIEW

' Dziedziczenie
User --|> Guest

' Zalogowany użytkownik
User --> UC_FILTER
User --> UC_SORT
User --> UC_ADD
User --> UC_EDIT
User --> UC_DEL
User --> UC_DETAILS
User --> UC_REPORT_AD
User --> UC_PUSH

' Administrator dziedziczy po użytkowniku
Admin --|> User

' Funkcje tylko dla admina
Admin --> UC_ADMIN_DEL
Admin --> UC_VIEW_REPORTED
Admin --> UC_REPORT

' Relacje include/extend
UC_FILTER ..> UC_VIEW : <<extend>>
UC_SORT ..> UC_VIEW : <<extend>>
UC_ADD ..> UC_LOG : <<include>>
UC_EDIT ..> UC_LOG : <<include>>
UC_DEL ..> UC_LOG : <<include>>
UC_DETAILS ..> UC_VIEW : <<extend>>
UC_REPORT_AD ..> UC_DETAILS : <<extend>>

@enduml
